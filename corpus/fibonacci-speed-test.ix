(function fib n
  (if (< n 2) n
      (+ (fib (dec n))
         (fib (- n 2)))))

(var results [])
(var top 10)
(function best-avg
  (when (< (len results) 2)
    (return (0 results)))
  (let tops (first top (sort results)))
  (floor (/ (.. + tops) (len tops))))

(function measure n
  (let report [(time) (fib 28) (time)])
  (let diff (- (2 report) (0 report)))
  (var results (append diff results))
  (print n " " (version) ": " (1 report) " took " diff "ms"
    "   " (best-avg) "ms best avg"))

(times 64 measure)

(str "Average of top " top " results: " (best-avg) "ms")
